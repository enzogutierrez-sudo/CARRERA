<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Sport Timer</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#080c10;--surface:#111720;--surface2:#1a2230;--border:#1e2d40;--accent:#00e5ff;--accent2:#ff6b35;--green:#39ff14;--text:#e8f4f8;--muted:#5a7a8a;--danger:#ff3b5c;--yellow:#ffed00}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;user-select:none}
body{background:var(--bg);color:var(--text);font-family:'DM Mono',monospace;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
.app{position:relative;z-index:1}
header{background:#111720;border-bottom:3px solid var(--yellow);padding:8px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
header img{height:48px;object-fit:contain;display:block}
.dot{width:10px;height:10px;border-radius:50%;background:var(--muted);transition:all .3s;display:inline-block;margin-right:6px}
.dot.on{background:var(--green);box-shadow:0 0 10px var(--green);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.6;transform:scale(1.3)}}
.stxt{font-size:11px;color:var(--muted)}

/* MODAL EVENTOS */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:100%;max-width:420px;max-height:85vh;overflow-y:auto;padding:20px}
.modal h2{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:var(--accent);margin-bottom:16px}
.modal h3{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:var(--muted);margin:16px 0 8px}
.minput{width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-family:'DM Mono',monospace;font-size:14px;margin-bottom:8px}
.minput:focus{outline:none;border-color:var(--accent)}
.mbtn{width:100%;padding:13px;border-radius:10px;border:none;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;cursor:pointer;margin-bottom:8px}
.mbtn.primary{background:var(--green);color:#000}
.mbtn.primary:active{opacity:.8}
.mbtn.secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
.mbtn.secondary:active{border-color:var(--accent)}
.mbtn.danger{background:transparent;color:var(--danger);border:1px solid var(--danger)}
.mbtn.danger:active{background:var(--danger);color:#fff}
.event-item{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:border-color .2s}
.event-item:active{border-color:var(--accent)}
.event-item.active{border-color:var(--green)}
.ei-name{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--text)}
.ei-info{font-size:11px;color:var(--muted);margin-top:2px}
.ei-actions{display:flex;gap:8px;margin-top:8px}
.ei-btn{padding:6px 12px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:12px;cursor:pointer}
.ei-btn.del{border-color:var(--danger);color:var(--danger)}
.ei-btn:active{opacity:.7}

/* EVENTO ACTIVO BAR */
.event-bar{background:var(--surface2);border-bottom:1px solid var(--border);padding:8px 16px;display:flex;align-items:center;justify-content:space-between}
.eb-name{font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--accent);letter-spacing:1px}
.eb-btn{padding:6px 12px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:12px;cursor:pointer;letter-spacing:1px}
.eb-btn:active{border-color:var(--accent);color:var(--accent)}

/* CSV */
.csv-wrap{margin:12px 16px}
.csv-btn{width:100%;padding:13px;border-radius:12px;border:2px dashed var(--border);background:var(--surface);color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;cursor:pointer;text-align:center;transition:all .2s;display:block}
.csv-btn.ok{border-color:var(--accent);color:var(--accent);border-style:solid}
.csv-btn input{display:none}

/* CRONOMETRO */
.chrono{padding:0 16px;text-align:center}
.cdisplay{font-family:'Bebas Neue',sans-serif;font-size:68px;letter-spacing:4px;color:var(--accent);text-shadow:0 0 30px rgba(0,229,255,.5);line-height:1;margin-bottom:12px}
.cdisplay.run{color:var(--green);text-shadow:0 0 30px rgba(57,255,20,.5)}
.cbtns{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px}
.cb{padding:12px 8px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;cursor:pointer}
.cb:active{transform:scale(.95)}
.cb.start{border-color:var(--green);color:var(--green)}
.cb.start:active{background:var(--green);color:#000}
.cb.stop{border-color:var(--danger);color:var(--danger)}
.cb.stop:active{background:var(--danger);color:#fff}
.cb.reset{border-color:var(--muted);color:var(--muted)}

/* NUMPAD */
.numpad{padding:0 16px 14px}
.ndisp{background:var(--surface2);border:2px solid var(--accent2);border-radius:12px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.nnum{font-family:'Bebas Neue',sans-serif;font-size:44px;letter-spacing:4px;color:var(--accent2);line-height:1}
.nname{font-size:11px;color:var(--accent);margin-top:2px;min-height:14px}
.ncat{font-size:10px;color:var(--muted)}
.nph{color:var(--muted);font-size:14px}
.ntime{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--accent)}
.ngrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.nb{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px 8px;font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--text);cursor:pointer;text-align:center;transition:all .1s}
.nb:active{background:var(--surface2);transform:scale(.94);border-color:var(--accent2)}
.nb.del{color:var(--danger);font-size:22px}
.nb.del:active{border-color:var(--danger)}
.nb.ok2{background:var(--green);color:#000;border-color:var(--green);font-size:22px;box-shadow:0 0 16px rgba(57,255,20,.3)}
.nb.ok2:active{opacity:.8}
.nb.ok2:disabled{background:var(--surface2);color:var(--muted);border-color:var(--border);box-shadow:none}

/* VOZ */
.micwrap{padding:0 16px 14px}
.micbtn{width:100%;padding:16px;border-radius:12px;border:2px solid var(--muted);background:var(--surface);color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:2px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:10px}
.micbtn.on{border-color:var(--green);color:var(--green);background:rgba(57,255,20,.05);box-shadow:0 0 20px rgba(57,255,20,.15)}
.vbuf{margin:0 16px 14px;background:var(--surface);border:1px solid var(--green);border-radius:12px;padding:12px 16px;display:none}
.vblabel{font-size:11px;color:var(--green);text-transform:uppercase;margin-bottom:8px;letter-spacing:1px}
.vbnums{display:flex;flex-wrap:wrap;gap:8px}
.vchip{font-family:'Bebas Neue',sans-serif;font-size:22px;background:rgba(57,255,20,.1);border:1px solid var(--green);border-radius:8px;padding:4px 12px;color:var(--green)}

/* ULTIMO */
.last{margin:0 16px 14px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 14px;display:flex;align-items:center;justify-content:space-between}
.llabel{font-size:11px;color:var(--muted);text-transform:uppercase;margin-bottom:2px}
.lval{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--accent2)}
.lname{font-size:11px;color:var(--accent);margin-top:1px}
.ltime{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--accent);text-align:right}
.ubtn{padding:10px 14px;border-radius:8px;border:1px solid var(--danger);background:transparent;color:var(--danger);font-family:'Bebas Neue',sans-serif;font-size:14px;cursor:pointer}
.ubtn:active{background:var(--danger);color:#fff}

/* TABLA */
.tsec{padding:0 16px 100px}
.thead{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.thead span{font-family:'Bebas Neue',sans-serif;font-size:17px;color:var(--muted)}
.expbtn{padding:8px 14px;border-radius:8px;border:1px solid var(--accent);background:transparent;color:var(--accent);font-family:'Bebas Neue',sans-serif;font-size:14px;cursor:pointer}
.expbtn:active{background:var(--accent);color:#000}
.elist{display:flex;flex-direction:column;gap:6px}
.erow{display:grid;grid-template-columns:40px 1fr auto auto;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
.epos{font-family:'Bebas Neue',sans-serif;font-size:14px;color:var(--muted)}
.edors{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--accent2)}
.ename{font-size:11px;color:var(--accent)}
.ecat{font-size:10px;color:var(--muted)}
.etime{font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--accent);text-align:right}
.delbtn{width:28px;height:28px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--muted);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.delbtn:active{border-color:var(--danger);color:var(--danger)}
.empty{text-align:center;padding:30px;color:var(--muted);font-size:13px}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-family:'Bebas Neue',sans-serif;font-size:13px;padding:10px 20px;border-radius:50px;z-index:300;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1}
</style>
</head>
<body>
<div class="app">
<header>
  <img id="logoimg" alt="Sport Timer">
  <div style="display:flex;align-items:center;gap:6px">
    <span class="dot" id="dot"></span>
    <span class="stxt" id="stxt">Listo</span>
  </div>
</header>

<div class="event-bar">
  <div class="eb-name" id="eb-name">Sin evento activo</div>
  <button class="eb-btn" id="btn-eventos">&#9776; EVENTOS</button>
</div>

<!-- MODAL EVENTOS -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h2>EVENTOS</h2>

    <h3>NUEVO EVENTO</h3>
    <input class="minput" type="text" id="new-name" placeholder="Nombre del evento (ej: Senderos Trail)">
    <input class="minput" type="date" id="new-date">
    <button class="mbtn primary" id="btn-crear">+ CREAR Y ACTIVAR</button>

    <h3>HISTORIAL</h3>
    <div id="event-list"><div style="color:var(--muted);font-size:13px;padding:10px 0">Sin eventos guardados</div></div>
  </div>
</div>

<div class="csv-wrap">
  <label class="csv-btn" id="csvlabel">
    <span id="csvtext">&#128203; CARGAR CSV DE ACREDITACION</span>
    <input type="file" accept=".csv" id="csvfile">
  </label>
</div>

<div class="chrono">
  <div class="cdisplay" id="cdisplay">00:00:00</div>
  <div class="cbtns">
    <button class="cb start" id="btnstart">&#9654; INICIAR</button>
    <button class="cb stop" id="btnstop">&#9632; PARAR</button>
    <button class="cb reset" id="btnreset">&#8635; RESET</button>
  </div>
</div>

<div class="numpad">
  <div class="ndisp">
    <div>
      <div class="nnum" id="nnum"><span class="nph">_ _ _ _</span></div>
      <div class="nname" id="nname"></div>
      <div class="ncat" id="ncat"></div>
    </div>
    <div class="ntime" id="ntime">--:--:--</div>
  </div>
  <div class="ngrid">
    <button class="nb" id="n1">1</button>
    <button class="nb" id="n2">2</button>
    <button class="nb" id="n3">3</button>
    <button class="nb" id="n4">4</button>
    <button class="nb" id="n5">5</button>
    <button class="nb" id="n6">6</button>
    <button class="nb" id="n7">7</button>
    <button class="nb" id="n8">8</button>
    <button class="nb" id="n9">9</button>
    <button class="nb" id="n0">0</button>
    <button class="nb del" id="ndel">&#9003;</button>
    <button class="nb ok2" id="nok" disabled>&#10003;</button>
  </div>
</div>

<div class="micwrap">
  <button class="micbtn" id="micbtn">
    <span>&#127908;</span><span id="miclabel">ACTIVAR COMANDO DE VOZ</span>
  </button>
</div>

<div class="vbuf" id="vbuf">
  <div class="vblabel">Detectando...</div>
  <div class="vbnums" id="vbnums"></div>
</div>

<div class="last" id="lastbox" style="display:none">
  <div>
    <div class="llabel">Ultimo registrado</div>
    <div class="lval" id="lval">-</div>
    <div class="lname" id="lname"></div>
  </div>
  <div style="text-align:right">
    <div class="ltime" id="ltime">-</div>
    <button class="ubtn" id="btnundo" style="margin-top:6px">&#10005; BORRAR</button>
  </div>
</div>

<div class="tsec">
  <div class="thead">
    <span id="ecount">0 REGISTROS</span>
    <button class="expbtn" id="btnexp">&#8595; CSV</button>
  </div>
  <div class="elist" id="elist"><div class="empty">Crea un evento y carga el CSV para empezar.</div></div>
</div>

<div class="toast" id="toast"></div>
</div>

<script>
(function() {

var LOGO = "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";
var FIREBASE = "https://sporttimer-482b3-default-rtdb.firebaseio.com";

document.getElementById("logoimg").src = "data:image/png;base64," + LOGO;

// State
var db = {};
var entries = [];
var npBuf = "";
var voiceOn = false;
var rec = null;
var chronoT0 = 0, chronoElapsed = 0, chronoRunning = false, chronoTimer = null;
var activeEventId = null;
var activeEventName = "Sin evento activo";
var eventHistory = [];

// Utils
function pad(n) { return n < 10 ? "0" + n : "" + n; }
function fmtTime(ms) {
  var h = Math.floor(ms / 3600000);
  var m = Math.floor((ms % 3600000) / 60000);
  var s = Math.floor((ms % 60000) / 1000);
  return pad(h) + ":" + pad(m) + ":" + pad(s);
}
function getElapsed() {
  return chronoRunning ? chronoElapsed + (Date.now() - chronoT0) : chronoElapsed;
}
function showToast(msg) {
  var t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(function() { t.classList.remove("show"); }, 2200);
}
function saveLocal() {
  try {
    localStorage.setItem("st_events", JSON.stringify(eventHistory));
    localStorage.setItem("st_active", activeEventId || "");
  } catch(e) {}
}

// EVENTOS MODAL
document.getElementById("btn-eventos").addEventListener("click", function() {
  renderEventList();
  document.getElementById("overlay").style.display = "flex";
});
document.getElementById("overlay").addEventListener("click", function(e) {
  if (e.target === this) this.style.display = "none";
});

function makeEventId(name, date) {
  var safe = name.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase().slice(0,12);
  return "race_" + (date||"").replace(/-/g,"") + "_" + safe;
}

document.getElementById("btn-crear").addEventListener("click", function() {
  var name = document.getElementById("new-name").value.trim();
  var date = document.getElementById("new-date").value;
  if (!name) { showToast("Ingresa el nombre del evento"); return; }
  if (!date) { date = new Date().toISOString().slice(0,10); }
  var id = makeEventId(name, date);
  // Check if already exists
  for (var i = 0; i < eventHistory.length; i++) {
    if (eventHistory[i].id === id) {
      activateEvent(eventHistory[i]);
      document.getElementById("overlay").style.display = "none";
      return;
    }
  }
  var ev = { id: id, name: name, date: date, count: 0 };
  eventHistory.unshift(ev);
  activateEvent(ev);
  saveLocal();
  document.getElementById("new-name").value = "";
  document.getElementById("overlay").style.display = "none";
  showToast("Evento creado: " + name);
});

function activateEvent(ev) {
  activeEventId = ev.id;
  activeEventName = ev.name;
  entries = [];
  document.getElementById("eb-name").textContent = ev.name + " — " + ev.date;
  render();
  updLast();
  // Load entries for this event from localStorage
  try {
    var saved = localStorage.getItem("st_entries_" + ev.id);
    if (saved) { entries = JSON.parse(saved); render(); updLast(); }
  } catch(e) {}
  saveLocal();
}

function renderEventList() {
  var list = document.getElementById("event-list");
  if (!eventHistory.length) {
    list.innerHTML = '<div style="color:var(--muted);font-size:13px;padding:10px 0">Sin eventos guardados</div>';
    return;
  }
  var html = "";
  for (var i = 0; i < eventHistory.length; i++) {
    var ev = eventHistory[i];
    var isActive = ev.id === activeEventId;
    html += '<div class="event-item' + (isActive ? " active" : "") + '" data-idx="' + i + '">'
      + '<div class="ei-name">' + ev.name + (isActive ? " &#9679;" : "") + '</div>'
      + '<div class="ei-info">' + ev.date + ' &mdash; ' + (ev.count||0) + ' registros</div>'
      + '<div class="ei-actions">'
      + '<button class="ei-btn" onclick="selectEvent(' + i + ')">ACTIVAR</button>'
      + '<button class="ei-btn" onclick="exportEventCSV(' + i + ')">&#8595; CSV</button>'
      + '<button class="ei-btn del" onclick="deleteEvent(' + i + ')">BORRAR</button>'
      + '</div>'
      + '</div>';
  }
  list.innerHTML = html;
}

window.selectEvent = function(idx) {
  activateEvent(eventHistory[idx]);
  document.getElementById("overlay").style.display = "none";
  showToast("Evento activo: " + eventHistory[idx].name);
};

window.deleteEvent = function(idx) {
  var ev = eventHistory[idx];
  if (ev.id === activeEventId) { showToast("No podes borrar el evento activo"); return; }
  try { localStorage.removeItem("st_entries_" + ev.id); } catch(e) {}
  // Delete from Firebase
  fetch(FIREBASE + "/races/" + ev.id + ".json", { method: "DELETE" }).catch(function(){});
  eventHistory.splice(idx, 1);
  saveLocal();
  renderEventList();
  showToast("Evento borrado");
};

window.exportEventCSV = function(idx) {
  var ev = eventHistory[idx];
  var evEntries = [];
  try {
    var saved = localStorage.getItem("st_entries_" + ev.id);
    if (saved) evEntries = JSON.parse(saved);
  } catch(e) {}
  if (!evEntries.length) { showToast("Sin registros en este evento"); return; }
  downloadCSV(evEntries, ev.name);
};

// CRONOMETRO
document.getElementById("btnstart").addEventListener("click", function() {
  if (chronoRunning) return;
  chronoT0 = Date.now(); chronoRunning = true;
  document.getElementById("cdisplay").classList.add("run");
  chronoTimer = setInterval(function() {
    document.getElementById("cdisplay").textContent = fmtTime(getElapsed());
  }, 100);
});
document.getElementById("btnstop").addEventListener("click", function() {
  if (!chronoRunning) return;
  chronoElapsed += Date.now() - chronoT0; chronoRunning = false;
  clearInterval(chronoTimer);
  document.getElementById("cdisplay").classList.remove("run");
});
document.getElementById("btnreset").addEventListener("click", function() {
  if (chronoRunning) {
    chronoElapsed += Date.now() - chronoT0; chronoRunning = false;
    clearInterval(chronoTimer);
    document.getElementById("cdisplay").classList.remove("run");
  }
  chronoElapsed = 0;
  document.getElementById("cdisplay").textContent = "00:00:00";
});

// CSV ACREDITACION
document.getElementById("csvfile").addEventListener("change", function() {
  var file = this.files[0]; if (!file) return;
  var reader = new FileReader();
  reader.onload = function(e) { parseCSV(e.target.result, file.name); };
  reader.readAsText(file, "ISO-8859-1");
});
function parseCSV(text, fname) {
  var lines = text.split("\n").filter(function(l) { return l.trim(); });
  if (!lines.length) return;
  var sep = lines[0].indexOf(";") >= 0 ? ";" : ",";
  var hdr = lines[0].replace(/\r/g,"").split(sep).map(function(h) { return h.trim().toUpperCase(); });
  var iN=-1, iNom=-1, iAp=-1, iC=-1, iD=-1, iT=-1;
  for (var i=0; i<hdr.length; i++) {
    if (hdr[i]==="NUMERO"||hdr[i]==="NRO"||hdr[i]==="DORSAL") iN=i;
    if (hdr[i]==="NOMBRE"||hdr[i]==="NAME") iNom=i;
    if (hdr[i]==="APELLIDO") iAp=i;
    if (hdr[i].indexOf("CAT")>=0) iC=i;
    if (hdr[i]==="DISTANCIA"||hdr[i]==="DIST") iD=i;
    if (hdr[i]==="TEAM"||hdr[i]==="EQUIPO"||hdr[i]==="CLUB") iT=i;
  }
  if (iN<0) { showToast("No encontre columna NUMERO"); return; }
  db={}; var count=0;
  for (var j=1; j<lines.length; j++) {
    var c=lines[j].replace(/\r/g,"").split(sep);
    var num=c[iN]?c[iN].trim():""; if(!num) continue;
    db[num]={
      name:[iNom>=0&&c[iNom]?c[iNom].trim():"", iAp>=0&&c[iAp]?c[iAp].trim():""].filter(Boolean).join(" "),
      cat: iC>=0&&c[iC]?c[iC].trim():"",
      dist: iD>=0&&c[iD]?c[iD].trim():"",
      team: iT>=0&&c[iT]?c[iT].trim():""
    };
    count++;
  }
  document.getElementById("csvlabel").className="csv-btn ok";
  document.getElementById("csvtext").textContent="OK: "+fname+" - "+count+" corredores";
  showToast("OK: "+count+" corredores cargados");
  try { localStorage.setItem("rdb", JSON.stringify(db)); } catch(e) {}
}
function getRunner(n) { return db[String(n)]||null; }

// NUMPAD
for (var d=0; d<=9; d++) {
  (function(digit) {
    document.getElementById("n"+digit).addEventListener("click", function() {
      if (npBuf.length>=4) return;
      npBuf+=digit; updNp();
    });
  })(d);
}
document.getElementById("ndel").addEventListener("click", function() { npBuf=npBuf.slice(0,-1); updNp(); });
document.getElementById("nok").addEventListener("click", function() {
  if (!npBuf) return; reg(parseInt(npBuf,10)); npBuf=""; updNp();
});
function updNp() {
  var ne=document.getElementById("nnum"), ok=document.getElementById("nok");
  var nn=document.getElementById("nname"), nc=document.getElementById("ncat");
  if (!npBuf.length) {
    ne.innerHTML='<span class="nph">_ _ _ _</span>';
    document.getElementById("ntime").textContent="--:--:--";
    nn.textContent=""; nc.textContent=""; ok.disabled=true;
  } else {
    ne.textContent=npBuf;
    document.getElementById("ntime").textContent=fmtTime(getElapsed());
    ok.disabled=false;
    var r=getRunner(npBuf);
    nn.textContent=r?r.name:""; nc.textContent=r?r.cat:"";
  }
}

// REGISTROS
function reg(num) {
  if (!activeEventId) { showToast("Primero crea o selecciona un evento"); return; }
  var t=fmtTime(getElapsed()), r=getRunner(num);
  entries.push({pos:entries.length+1, dorsal:num, tiempo:t, ms:getElapsed(),
    name:r?r.name:"", cat:r?r.cat:"", dist:r?r.dist:"", team:r?r.team:""});
  render(); updLast(); save();
}
document.getElementById("btnundo").addEventListener("click", function() {
  if (!entries.length) return;
  entries.pop();
  for (var i=0; i<entries.length; i++) entries[i].pos=i+1;
  render(); updLast(); save();
});
window.delEntry = function(i) {
  entries.splice(i,1);
  for (var j=0; j<entries.length; j++) entries[j].pos=j+1;
  render(); updLast(); save();
};
function updLast() {
  var box=document.getElementById("lastbox");
  if (!entries.length) { box.style.display="none"; return; }
  box.style.display="flex";
  var e=entries[entries.length-1];
  document.getElementById("lval").textContent="# "+e.dorsal+(e.name?" - "+e.name:"");
  document.getElementById("lname").textContent=e.cat||"";
  document.getElementById("ltime").textContent=e.tiempo;
}
function render() {
  var list=document.getElementById("elist");
  document.getElementById("ecount").textContent=entries.length+" REGISTROS";
  if (!entries.length) { list.innerHTML='<div class="empty">Sin registros aun.</div>'; return; }
  var html="";
  for (var i=entries.length-1; i>=0; i--) {
    var e=entries[i];
    html+='<div class="erow">'
      +'<div class="epos">'+e.pos+'</div>'
      +'<div><div class="edors"># '+e.dorsal+'</div>'
      +(e.name?'<div class="ename">'+e.name+'</div>':'')
      +(e.cat?'<div class="ecat">'+e.cat+'</div>':'')
      +'</div>'
      +'<div class="etime">'+e.tiempo+'</div>'
      +'<button class="delbtn" onclick="delEntry('+i+')">x</button>'
      +'</div>';
  }
  list.innerHTML=html;
}

// SAVE
function save() {
  if (!activeEventId) return;
  // Update count in history
  for (var i=0; i<eventHistory.length; i++) {
    if (eventHistory[i].id===activeEventId) { eventHistory[i].count=entries.length; break; }
  }
  saveLocal();
  try { localStorage.setItem("st_entries_"+activeEventId, JSON.stringify(entries)); } catch(e) {}
  fetch(FIREBASE+"/races/"+activeEventId+".json", {
    method:"PUT",
    body:JSON.stringify({entries:entries, name:activeEventName, updated:Date.now()})
  }).catch(function(){});
}

// CSV EXPORT — solo Dorsal y Tiempo
function downloadCSV(data, name) {
  var rows=[["Dorsal","Tiempo"]];
  for (var i=0; i<data.length; i++) {
    rows.push([data[i].dorsal, data[i].tiempo]);
  }
  var csv=rows.map(function(r){return r.join(",");}).join("\n");
  var blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
  var url=URL.createObjectURL(blob);
  var a=document.createElement("a");
  a.href=url; a.download=(name||"resultados").replace(/\s+/g,"_")+".csv"; a.click();
  URL.revokeObjectURL(url);
}
document.getElementById("btnexp").addEventListener("click", function() {
  if (!entries.length) { showToast("Sin registros"); return; }
  downloadCSV(entries, activeEventName);
});

// VOZ
var NUMS={cero:0,un:1,uno:1,una:1,dos:2,tres:3,cuatro:4,cinco:5,seis:6,siete:7,ocho:8,nueve:9,diez:10,once:11,doce:12,trece:13,catorce:14,quince:15,dieciseis:16,diecisiete:17,dieciocho:18,diecinueve:19,veinte:20,veintiun:21,veintiuno:21,veintidos:22,veintitres:23,veinticuatro:24,veinticinco:25,veintiseis:26,veintisiete:27,veintiocho:28,veintinueve:29,treinta:30,cuarenta:40,cincuenta:50,sesenta:60,setenta:70,ochenta:80,noventa:90,cien:100,ciento:100,doscientos:200,doscientas:200,trescientos:300,trescientas:300,cuatrocientos:400,cuatrocientas:400,quinientos:500,quinientas:500,seiscientos:600,seiscientas:600,setecientos:700,setecientas:700,ochocientos:800,ochocientas:800,novecientos:900,novecientas:900,mil:1000};
function norm(t) {
  return t.toLowerCase().replace(/[áàä]/g,"a").replace(/[éèë]/g,"e").replace(/[íìï]/g,"i").replace(/[óòö]/g,"o").replace(/[úùü]/g,"u").replace(/ñ/g,"n");
}
function extractNums(text) {
  text=norm(text);
  var dm=text.match(/[0-9]{1,4}/g);
  if (dm&&dm.length) return dm.map(Number).filter(function(n){return n>=1&&n<=9999;});
  var results=[],segs=text.split(/coma|luego|despues|siguiente/);
  for (var s=0; s<segs.length; s++) {
    var words=segs[s].trim().split(/\s+/),cur=0,res=0,found=false;
    for (var w=0; w<words.length; w++) {
      var word=words[w]; if(word==="y") continue;
      var v=NUMS[word]; if(v===undefined) continue; found=true;
      if(v===1000){cur=cur===0?1:cur;res+=cur*1000;cur=0;}
      else if(v>=100){cur+=v;}else{cur+=v;}
    }
    res+=cur;
    if(found&&res>=1&&res<=9999) results.push(res);
  }
  return results;
}
var SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if (SR) {
  rec=new SR(); rec.lang="es-AR"; rec.continuous=true; rec.interimResults=true; rec.maxAlternatives=3;
  rec.onresult=function(e) {
    var interim="";
    for (var i=e.resultIndex; i<e.results.length; i++) {
      var t=e.results[i][0].transcript;
      if (e.results[i].isFinal) { var ns=extractNums(t); if(ns.length){ns.forEach(reg);hideBuf();} }
      else { interim+=t; showBuf(interim); }
    }
  };
  rec.onerror=function(e){if(e.error!=="no-speech")setVoz(false);};
  rec.onend=function(){if(voiceOn){try{rec.start();}catch(ex){}}};
}
function showBuf(txt) {
  var ns=extractNums(txt), buf=document.getElementById("vbuf");
  buf.style.display="block";
  document.getElementById("vbnums").innerHTML=ns.length
    ?ns.map(function(n){return '<div class="vchip">'+n+'</div>';}).join("")
    :'<span style="color:var(--muted);font-size:12px">'+txt+'</span>';
}
function hideBuf(){document.getElementById("vbuf").style.display="none";document.getElementById("vbnums").innerHTML="";}
document.getElementById("micbtn").addEventListener("click", function() {
  if(!rec){showToast("Voz no disponible");return;}
  voiceOn=!voiceOn;
  if(voiceOn){try{rec.start();}catch(ex){}setVoz(true);}
  else{rec.stop();setVoz(false);hideBuf();}
});
function setVoz(on) {
  voiceOn=on;
  document.getElementById("miclabel").textContent=on?"ESCUCHANDO - DECI LOS NUMEROS":"ACTIVAR COMANDO DE VOZ";
  document.getElementById("stxt").textContent=on?"Escuchando":"Listo";
  document.getElementById("micbtn").classList.toggle("on",on);
  document.getElementById("dot").classList.toggle("on",on);
}

// INIT
try {
  var rdb=localStorage.getItem("rdb");
  if(rdb){db=JSON.parse(rdb);var c=Object.keys(db).length;if(c>0){document.getElementById("csvlabel").className="csv-btn ok";document.getElementById("csvtext").textContent="CSV cargado - "+c+" corredores";}}
  var evs=localStorage.getItem("st_events");
  if(evs) eventHistory=JSON.parse(evs);
  var act=localStorage.getItem("st_active");
  if(act){for(var ii=0;ii<eventHistory.length;ii++){if(eventHistory[ii].id===act){activateEvent(eventHistory[ii]);break;}}}
} catch(ex) {}

// Show modal on first load if no active event
if (!activeEventId) {
  var today = new Date().toISOString().slice(0,10);
  document.getElementById("new-date").value = today;
  document.getElementById("overlay").style.display = "flex";
}

})();
</script>
</body>
</html>
